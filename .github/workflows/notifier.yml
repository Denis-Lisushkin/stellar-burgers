name: PR Telegram Notifier

on:
  pull_request:
    types: [opened, closed]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Telegram Notification
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          if [[ "${{ github.event.action }}" == "opened" ]]; then
            MESSAGE="üì¢ *–ù–æ–≤—ã–π Pull Request!*\n\nüë§ –ê–≤—Ç–æ—Ä: ${{ github.actor }}\nüîÄ –ò–∑ –≤–µ—Ç–∫–∏: *${{ github.event.pull_request.head.ref }}*\n‚û°Ô∏è –í –≤–µ—Ç–∫—É: *${{ github.event.pull_request.base.ref }}*\nüìù –ó–∞–≥–æ–ª–æ–≤–æ–∫: *${{ github.event.pull_request.title }}*\nüîó –°—Å—ã–ª–∫–∞: ${{ github.event.pull_request.html_url }}"
          elif [[ "${{ github.event.action }}" == "closed" && "${{ github.event.pull_request.merged }}" == "true" ]]; then
            MESSAGE="‚úÖ *Pull Request —Å–º–µ—Ä–∂–µ–Ω!*\n\nüë§ –ê–≤—Ç–æ—Ä: ${{ github.actor }}\nüîÄ –ò–∑ –≤–µ—Ç–∫–∏: *${{ github.event.pull_request.head.ref }}*\n‚û°Ô∏è –í –≤–µ—Ç–∫—É: *${{ github.event.pull_request.base.ref }}*\nüìù –ó–∞–≥–æ–ª–æ–≤–æ–∫: *${{ github.event.pull_request.title }}*\nüîó –°—Å—ã–ª–∫–∞: ${{ github.event.pull_request.html_url }}"

            # –¥–æ–±–∞–≤–ª—è–µ–º –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –¥–ª—è –≤–µ—Ç–∫–∏ dev
            if [[ "${{ github.event.pull_request.base.ref }}" == "main" ]]; then
              MESSAGE="$MESSAGE\n\n‚ö†Ô∏è –ù–µ –∑–∞–±—É–¥—å—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:\n\`git pull origin main\`"
            fi
          else
            exit 0
          fi

          curl -s -X POST https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage \
            -d chat_id=${TELEGRAM_CHAT_ID} \
            -d parse_mode="Markdown" \
            -d text="$MESSAGE"
